<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 8 ]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <noscript><meta http-equiv="refresh" content="0; RL=/nojavascript"/></noscript>

  <!--[if lt IE 7 ]> 
  <script type="text/javascript">
        window.location = '/ie6';
  </script>

  <![endif]-->
  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>A.P.E.S.</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile viewport optimized: j.mp/bplateviewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Place favicon.ico & apple-touch-icon.png in the root of your domain and delete these references
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
 -->

  <!-- CSS: implied media="all" -->
  <%= css :application %>
  <link rel="stylesheet" href="css/jquery.jscrollpane.css">

  <!-- Uncomment if you are specifically targeting less enabled mobile browsers
  <link rel="stylesheet" media="handheld" href="css/handheld.css?v=2">  -->

  <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects -->
  <script src="js/libs/modernizr-2.0.6.js"></script>
  <script src="jst.tpl"></script>

  <script src="js/mootools-1.2.5-core-nc.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/moochart-0.1b1.js" type="text/javascript" charset="utf-8"></script>
</head>

<body class="tool ">

  <div id="wrapper">
    <header id="head" class='horizontal_box_shadow'>
      <div class="head_nav">
        <ul>
          <li><a href="/about" title="">about</a></li>
          <li><a href="/contact" title="">contact</a></li>
          <li><a href="#" title="">language</a></li>
        </ul>
      </div>
    </header>
    <div class="menu_subpage">
      <ul>
        <li><a class="sub_portal" id="portal_activ" href="#">Portal</a>
        <ul>
          <li><a class="por" href="portal/species">Species</a></li>
          <li><a class="por" href="portal/topic">Topic</a></li>
          <li><a class="por" href="portal/geography">Geography</a></li>
          <li><a class="por" href="portal/tools">Tools</a></li>
        </ul>
        </li>
        <li><a class="sub_data" href="#">Database</a>
        <ul>
          <li><a class="dat" href="database/archiveTable">Data Archive</a></li>
          <li><a class="dat" href="database/literature">Literature</a></li>
          <li><a class="dat" href="database/policy">Policy</a></li>
          <li><a class="dat" href="database/surveyGuidelines">Survey Guidelines</a></li>
        </ul>
        </li>
        <li><a class="sub_report" href="#">Report</a>
        <ul>
          <li><a class="rep" href="report/annual">Annual Report</a></li>
          <li><a class="rep" href="report/archive">Archive</a></li>
        </ul>
        </li>
        <li><a class="sub_wiki" href="http://apes.eva.mpg.de/apeswiki/index.php/Main_Page" target="_blank">Wiki</a></li>
      </ul>
    </div>

    <div id="main" role="main" class='horizontal_box_shadow'>

        <div id='filter_pane'>
            <ul class='filters' id='filter-selector'>
                <li>
                  Species: <i>All</i> <span class='btn'>Edit</span>
                  <ul class='selected-list'></ul>
                </li>
                <li>
                  Countries: <i>GB, FR, ES...</i> <span class='btn'>Edit</span>
                </li>
            </ul>
            <ul class='filters'>
                <li>Filter 1<div class='filter-slider'></div></li>
                <li class='active'>Filter 2<div class='filter-slider'></div></li>
                <li>Filter 3<div class='filter-slider'></div></li>
                <li>Filter 4<div class='filter-slider'></div></li>
            </ul>
            <ul class='filters'>
                <li>Size<div class='filter-slider'></div></li>
            </ul>
            <div id='result-area'>
                <span id='result-strip'><span id='result-count'>50</span> sites</span>
                <div id='view-selector'>
                    <a href='#graph'>Graph</a><a href='#main_map'>Map</a><a href='#table'>Table</a>
                </div>
            </div>
        </div>

        <div id='results_container'>
            <div id='graph'></div>
            <div class="map_container" id="main_map">
                <div class="map"></div>
                <!-- zoom-control -->
                <div class="zoom_control">
                  <a href="#zoom_in" class="zoom_in">zoom_in</a>
                  <a href="#zoom_out" class="zoom_out">zoom_out</a>
                </div>
                <!-- end zoom control -->
                <!--
                <div class="layer_editor">
                    <a href="#" class="layer_raster"></a>
                    <a href="#" class="layer_google_maps"></a>
                </div>
                -->
                <div class="crosshair">
                    <img src="/img/icons/crosshair_map.png" />
                </div>
                <div class="tiles_info"><span></span></div>
                <div class="layers">
                    <a href="#view" class="view"><span>VIEWING <b class="layer_number">3 LAYERS</b></span></a>
                    <div class="show">
                        <span class="top"></span>
                        <ul class="dropdown">
                            <a class="expand" href="#expand">expand</a>
                        </ul>
                    </div>
                </div>

                <!-- search box -->
                <div class="search">
                  <h1>search</h1>
                  <input type='text' placeholder='............................' />
                  <a href="#search">&nbsp;&nbsp;</a>
                </div>

                <div id="polygon_popup">
                    <a id='done' href="">done</a>
                    <a id='delete' href="">delete</a>
                </div> <!-- polygon_popup -->

                <div id="protected_popup" class="popup_text">
                    <div class="top"></div>
                    <div class="center">
                      <a href='#' class="close"></a>
                      <h1 class="name">name</h1>
                    </div>
                    <div class="bottom">
                      <a id='add_protected' href="#"><span>add this to the analisys</span></a>
                    </div>
                </div> <!-- polygon_popup -->


                <a class="cartodb_logo" href="http://cartodb.com"></a>
            </div>
        </div>


        <div id="panel">
            <div id="tabs">
                <ul>
                   <li class="add"><a href="#add_new_one" class="add">+</a></li>
                   <li class="total last"><a href="#summary">summary</a></li>
                </ul>
            </div>
            <div id="tab_content">
            </div>
            <!-- tooltip -->
            <div class="list_tooltip">
            </div>
            <%= erb :_help_tooltips %>
        </div>

        <div id="selected_filters">
        </div>

        <div id="filter_edit">
            <div class="inner">
                <div class="help">
                    <h1>Welcome to the Apes Mapper tool</h1>
                    <h2>Select Species</h2>
                    <div class="selector" id='species_selector'>Loading species...</div>
                </div> <!-- help -->

                <div class="help">
                    <h2>Select Countries</h2>
                    <div class="selector" id='countries_selector'>Loading countries...</div>
                    <button id="save_filter" disabled='true'><span class="button_info">Initialising app...</span></button>
                </div> <!-- help -->
            </div> <!-- inner -->
        </div>

      <div id="error_dialog">
        <div class="error_wrapper">
          <!--<a href='#' class="close"></a>-->
          <!--<h1 id="title">ERROR</h1>-->
          <p id="error_text">An error ocurred</p>
          <a id="ok" href="#">ok</a>
        </div>
      </div>
    </div>

    <div id="sponsors" class='horizontal_box_shadow'>
      <ul style="padding-left:40px;">
        <li><a href="#" style="margin-left:0px;" title=""><img src="/img/sponsors/arcus.gif" alt="" /></a></li>
        <li><a href="#" title=""><img src="/img/sponsors/unep.gif" alt="" /></a></li>
        <li><a href="#" title=""><img src="/img/sponsors/wcmc.gif" alt="" /></a></li>
        <li><a href="#" title=""><img src="/img/sponsors/wild.gif" alt="" /></a></li>
        <li><a href="#" title=""><img src="/img/sponsors/esri.gif" alt="" /></a></li>
        <li><a href="#" title=""><img src="/img/sponsors/wwf.gif" alt="" /></a></li>
        <li><a href="#" title=""><img src="/img/sponsors/iucn.gif" alt="" /></a></li>
        <li><a href="#" title=""><img src="/img/sponsors/jane.gif" alt="" /></a></li>
        <li><a href="#" title=""><img src="/img/sponsors/mpg.gif" alt="" /></a></li>
      </ul>
    </div>

    <footer id="footer">
      <img src="/img/footer/footer-logo.png" style="float:left;" alt="Logo-Footer" />
      <ul class="footer_nav">
        <li><a class="contact" href="/partners" title="">Partners</a></li>
        <li><a class="imprint" href="#" title="">Philosophy</a></li>
        <li><a class="faq" href="#" title="">FAQ</a></li>
        <li><a class="support" href="#" title="">Support A.P.E.S.</a></li>
      </ul>
    </footer>
  </div> <!--! end of #container -->

  <!-- templates -->
  <script type="text/template" id="report-tmpl">
    <%= File.open('app/views/_report.jst.tpl').read %>
  </script>

  <script type="text/template" id="report-tmpl-common">
    <%= File.open('app/views/_report_common.jst.tpl').read %>
  </script>

  <script type="text/template" id="species-selector-tmpl">
    <%= File.open('app/views/_species_selector.jst.tpl').read %>
  </script>

  <script type="text/template" id="countries-selector-tmpl">
    <%= File.open('app/views/_countries_selector.jst.tpl').read %>
  </script>

  <script type="text/template" id="selected-filters-tmpl">
    <%= File.open('app/views/_selected_filters.jst.tpl').read %>
  </script>

  <script type="text/template" id="report-tmpl-no-content">
    <div class="no_content">
      <div class="inner">
          <span class="title">
              <h2>DRAW YOUR FIRST POLYGON</h2>
          </span>
          <p>Start clicking on the map for drawing the first polygon of this AOI.</p>
      </div>
      <span class="end"></span>
      <span style="display:none" class="loader"></span>
    </div>
  </script>

  <!-- JavaScript at the bottom for fast page loading -->

  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if necessary -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
  <script>window.jQuery || document.write("<script src='js/libs/jquery-1.5.1.min.js'>\x3C/script>")</script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&libraries=geometry""></script>
  <script>window.JSON || document.write("<script src='js/libs/json2.js'>\x3C/script>")</script>

  <%= js  :main_app %>

  <script>
    function number_format(n) {
        var s = n.toFixed(0);
        var chrs = [];
        var c = 0;
        for(var i = s.length - 1; i != -1; --i, ++c) {
            if(((c % 3) == 0) && c > 0) {
                chrs.push(',');
            }
            chrs.push(s.charAt(i));
        }
        return chrs.reverse().join('');
    }
  </script>


  <!-- end scripts-->
  <script>
    jQuery.noConflict();
    function init() {
      // use timeout trick to avoid jquery catch the exceptions thrown
      setTimeout(function() {
        App(function(app) {
          var carbon = new app.Carbon();
          carbon.run();
          //debug
          window.carbon = carbon;
          window._app= app;
        });
      }, 100);
    }
    jQuery(document).ready(function() {
      init();

      var $ = jQuery;
      $("div.filter-slider").slider({
        range: true,
        min: 0,
        max: 500,
        values: [ 75, 300 ],
        slide: function( event, ui ) {
          $( "#amount" ).val( "$" + ui.values[ 0 ] + " - $" + ui.values[ 1 ] );
        }
      });
      $( "#amount" ).val( "$" + $( "div.filter-slider" ).slider( "values", 0 ) + " - $" + $( "div.filter-slider" ).slider( "values", 1 ) );
    });

    window.addEvent('domready', function() {
      // Graph
      var chart1 = new Chart.Bubble('graph', {
        width: 639,
        height: 500,
        lineColor: '#3f3f3f',
        zmin: 0, zmax: 100,
        bubbleSize: 40
      });

      chart1.bubbles = [
        {x: 82, y: 70, z: 90, color: '#318bd6', tip: '<b>HTML</b> is allowed in <span style="color: #71a8d6;">tooltips</span>'},
        {x: 21, y: 11, z: 0, color: '#000', tip: 'This bubble is the minimum size'},
        {x: 0, y: 0, z: 100, color: '#319344', tip: 'Bubbles can <u>never</u> fall outside the grid'},
        {x: 10, y: 100, z: 50, color: '#959300', tip: 'Behind'},
        {x: 12, y: 92, z: 40, color: '#802b60', tip: 'Smaller bubbles will render above bigger ones'},
        {x: 100, y: 100, z: 100, color: '#1727a3', tip: '<i>Top</i> <b>Big</b> <u>Left</u>'},
        {x: 50, y: 50, z: 50, color: '#1727a3', tip: 'Tooltips can have<br />multiple lines. Like this<br />And this'},
      ];

      chart1.redraw();
    });
  </script>


  <!--[if lt IE 7 ]>
    <script src="js/libs/dd_belatedpng.js"></script>
    <script>DD_belatedPNG.fix("img, .png_bg"); // Fix any <img> or .png_bg bg-images. Also, please read goo.gl/mZiyb </script>
  <![endif]-->


  <!-- mathiasbynens.be/notes/async-analytics-snippet Change UA-XXXXX-X to be your site's ID -->
  <!--<script>
    var _gaq=[["_setAccount","UA-6510422-1"],["_trackPageview"]];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
    g.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js";
    s.parentNode.insertBefore(g,s)}(document,"script"));
   </script>-->

</body>
</html>
